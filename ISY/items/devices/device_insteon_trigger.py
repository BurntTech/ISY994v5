#! /usr/bin/env python



'''


Event property from Device: Kids Bathroom Vanity Light ((('status', 'ready'),),)
Event add from Device: Kids Bathroom Vanity Light (((),),)
No device class for Device: Name triiger-Opened Address 14 8F 76 1, Family 1, Type 16.2.52.0, Def ID BinaryAlarm
Event property from Device: triiger-Closed ((('status', 'ready'),),)
Event add from Device: triiger-Closed (((),),)
No device class for Device: Name 1C.20.63 - B Address 1C 20 63 1, Family 1, Type 0.18.54.0, Def ID RemoteLinc2


Event property from Controller: controller ((('heartbeat', datetime.datetime(2019, 6, 1, 12, 15, 52, 401405)),),)
WS Event Event: Address None, Control _0, Action 120, Event Info None
Event property from Controller: controller ((('heartbeat', datetime.datetime(2019, 6, 1, 12, 16, 17, 399339)),),)
WS Event Event: Address 1C 20 63 1, Control DOF, Action 0, Event Info None
WS Event Event: Address 1C 20 63 1, Control ST, Action 0, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 1]      DOF   0
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 1]       ST   0 (uom=100 prec=0)
WS Event Event: Address 1C 20 63 1, Control DON, Action 0, Event Info None
WS Event Event: Address 1C 20 63 1, Control ST, Action 255, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 1]      DON   0
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 1]       ST 255 (uom=100 prec=0)
WS Event Event: Address 1C 20 63 2, Control DOF, Action 0, Event Info None
WS Event Event: Address 1C 20 63 2, Control ST, Action 0, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 2]      DOF   0
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 2]       ST   0 (uom=100 prec=0)
WS Event Event: Address None, Control _0, Action 120, Event Info None
Event property from Controller: controller ((('heartbeat', datetime.datetime(2019, 6, 1, 12, 16, 42, 398011)),),)
WS Event Event: Address 1C 20 63 2, Control DON, Action 0, Event Info None
Event property from Device: 1C.20.63 - A ((('paddle_action', 'DON'),),)
WS Event Event: Address 1C 20 63 2, Control ST, Action 255, Event Info None
Event property from Device: 1C.20.63 - A ((('onoff', 'on'),),)
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 2]      DON   0
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 2]       ST 255 (uom=100 prec=0)
WS Event Event: Address 1C 20 63 3, Control DOF, Action 0, Event Info None
WS Event Event: Address 1C 20 63 3, Control ST, Action 0, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 3]      DOF   0
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 3]       ST   0 (uom=100 prec=0)
WS Event Event: Address 1C 20 63 5, Control DOF, Action 0, Event Info None
WS Event Event: Address 1C 20 63 5, Control ST, Action 0, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 5]      DOF   0
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 5]       ST   0 (uom=100 prec=0)
WS Event Event: Address 1C 20 63 8, Control DFOF, Action 0, Event Info None
Event property from Device: 1C.20.63 - G ((('paddle_action', 'DFOF'),),)
WS Event Event: Address 1C 20 63 8, Control ST, Action 0, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 8]     DFOF   0
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 8]       ST   0 (uom=100 prec=0)
WS Event Event: Address 1C 20 63 6, Control DFOF, Action 0, Event Info None
Event property from Device: 1C.20.63 - E ((('paddle_action', 'DFOF'),),)
WS Event Event: Address 1C 20 63 6, Control ST, Action 0, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 6]     DFOF   0
WS Event Event: Address None, Control _1, Action 3, Event Info [  1C 20 63 6]       ST   0 (uom=100 prec=0)



Event Event: Address None, Control _1, Action 0, Event Info None
Event property from Program: All Second Third Floor Buttons Update ((('state', 'idle'),),)
Event property from Program: All Second Third Floor Buttons Update ((('last_finish_time', '190601 12:13:10'),),)
WS Event Event: Address None, Control _5, Action 1, Event Info None
Event property from Controller: controller ((('state', 'busy'),),)
WS Event Event: Address None, Control _5, Action 0, Event Info None
Event property from Controller: controller ((('state', 'idle'),),)
WS Event Event: Address None, Control _1, Action 0, Event Info None
Event property from Program: All Interior Buttons Update ((('state', 'idle'),),)
Event property from Program: All Interior Buttons Update ((('last_finish_time', '190601 12:13:10'),),)
WS Event Event: Address 22 73 85 4, Control ST, Action 255, Event Info None
Event property from Device: Second Third Floor All ((('level', 100.0),),)
Event property from Scene: Second Third Floor All Button ((('onoff', 'on'),),)
WS Event Event: Address None, Control _1, Action 3, Event Info [  22 73 85 4]       ST 255 (uom=100 prec=0)
WS Event Event: Address None, Control _0, Action 120, Event Info None
Event property from Controller: controller ((('heartbeat', datetime.datetime(2019, 6, 1, 12, 13, 22, 412833)),),)
WS Event Event: Address None, Control _0, Action 120, Event Info None
Event property from Controller: controller ((('heartbeat', datetime.datetime(2019, 6, 1, 12, 13, 47, 411628)),),)
WS Event Event: Address 14 8F 76 1, Control DOF, Action 1, Event Info None
WS Event Event: Address 14 8F 76 1, Control ST, Action 0, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  14 8F 76 1]      DOF   1
WS Event Event: Address None, Control _1, Action 3, Event Info [  14 8F 76 1]       ST   0 (uom=100 prec=0)
WS Event Event: Address 14 8F 76 1, Control DON, Action 1, Event Info None
WS Event Event: Address 14 8F 76 1, Control ST, Action 255, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  14 8F 76 1]      DON   1
WS Event Event: Address None, Control _1, Action 3, Event Info [  14 8F 76 1]       ST 255 (uom=100 prec=0)
WS Event Event: Address None, Control _0, Action 120, Event Info None
Event property from Controller: controller ((('heartbeat', datetime.datetime(2019, 6, 1, 12, 14, 12, 408644)),),)
WS Event Event: Address 14 8F 76 1, Control DOF, Action 1, Event Info None
WS Event Event: Address 14 8F 76 1, Control ST, Action 0, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  14 8F 76 1]      DOF   1
WS Event Event: Address None, Control _1, Action 3, Event Info [  14 8F 76 1]       ST   0 (uom=100 prec=0)
WS Event Event: Address 14 8F 76 1, Control DON, Action 1, Event Info None
WS Event Event: Address 14 8F 76 1, Control ST, Action 255, Event Info None
WS Event Event: Address None, Control _1, Action 3, Event Info [  14 8F 76 1]      DON   1
WS Event Event: Address None, Control _1, Action 3, Event Info [  14 8F 76 1]       ST 255 (uom=100 prec=0)

'''

from .device_dimmer import Device_Dimmer
from .device_insteon_base import Device_Insteon_Base

paddle_events = {'DON','DOFF','DIM','BRT','DFON','DFOF'}

class Device_Insteon_Dimmer(Device_Dimmer,Device_Insteon_Base):

    def __init__(self, container, device_info):
        Device_Dimmer.__init__(self,container,device_info.name)
        Device_Insteon_Base.__init__(self, device_info)

        self.add_property('paddle_action')
        
        if device_info.property_value:        
            try:
                self.properties ['level'] = int(int(device_info.property_value)/255*100)
            except:
                pass

    def process_websocket_event(self,event):
            if event.control == 'ST':
                self.set_property('level',int(event.action)/255*100)
                #print ('device {}. changed status to {}'.format(self.name,event.action))

            elif event.control in paddle_events: #need to add other events
                self.set_property('paddle_action',event.control)
                #print ('device {}. changed local control {}'.format(self.name,event.action))

    def set_level(self,level):
        path = ('nodes/' + self.address + '/cmd/DON/' + str(int(level*255)))
        return self.send_request(path)

    def fast_on(self):
        path = ('nodes/' + self.address + '/cmd/DFON')
        return self.send_request(path)

    def fast_off(self):
        path = ('nodes/' + self.address + '/cmd/DFOF')
        return self.send_request(path)

    def brighten(self):
        path = ('nodes/' + self.address + '/cmd/BRT')
        return self.send_request(path)

    def dim(self):
        path = ('nodes/' + self.address + '/cmd/DIM')
        return self.send_request(path)
